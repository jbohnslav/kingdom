---
id: 304a
status: closed
deps: []
links: []
created: 2026-02-07T22:33:49Z
type: task
priority: 1
---
# Agent config model

Parse agent definition .md files from .kd/agents/. Markdown with YAML frontmatter (name, backend, cli, resume_flag). Replace hardcoded ClaudeMember/CodexMember/CursorAgentMember classes with a single config-driven Agent class that builds commands from the config. Keep the existing CouncilMember.parse_response() logic as backend-specific parsers. Create default agent files on kd init.

## Acceptance
- [x] load_agent(name) reads .kd/agents/<name>.md and returns config
- [x] list_agents() returns all registered agents
- [x] Agent config drives command building (replaces hardcoded CLI strings)
- [x] Backend-specific response parsing preserved (claude JSON, codex JSONL, cursor JSON)
- [x] kd init creates default agent files for claude, codex, cursor
- [x] kd doctor checks agent CLIs based on config

## Worklog

- Created `src/kingdom/agent.py` with AgentConfig dataclass, parse/serialize/load/list, default configs, and backend-specific command builders + response parsers
- Command building dispatches on `backend` field: claude uses `-p` prompt flag, codex uses subcommand-style `exec resume <id>`, cursor uses positional prompt with trailing `--resume`
- Response parsing extracted from old ClaudeMember/CodexMember/CursorAgentMember — logic unchanged, just moved to standalone functions keyed by backend name
- `CouncilMember` in base.py is now concrete (was abstract), takes `AgentConfig`, delegates to `build_command()` and `parse_response()` from agent.py
- Deleted `council/claude.py`, `council/codex.py`, `council/cursor.py`
- `Council.create()` gained `base` param — loads from `.kd/agents/` if present, falls back to `DEFAULT_AGENTS`
- `kd doctor` now derives checks from agent configs (`version_command`, `install_hint`) instead of hardcoded `DOCTOR_CHECKS` list
- Decision: kept `cli` + `resume_flag` config fields per design doc; backend-specific command assembly handled by dispatch on `backend` rather than command templates — cleaner for codex's subcommand resume pattern
- 42 new tests in `tests/test_agent.py`, all 220 tests passing
