---
id: 0360
status: closed
deps: []
links: []
created: 2026-02-09T18:49:00Z
type: task
priority: 3
---
# Peasant sync â€” pull parent branch changes into worktree

Worktrees are created from a point-in-time snapshot. When the parent branch moves forward (bug fixes, test updates, other tickets merged), the worktree becomes stale. During the 41f9 smoke test, the peasant's worktree had outdated tests that caused false failures.

`kd peasant sync <ticket-id>` merges the parent branch into the worktree's ticket branch, then runs `init-worktree.sh` to refresh dependencies.

## Acceptance Criteria

- [x] `kd peasant sync kin-XXXX` merges current branch into the worktree's ticket branch
- [x] Runs `.kd/init-worktree.sh` after merge to refresh dependencies
- [x] Fails cleanly on merge conflicts with instructions to resolve manually
- [x] Refuses to sync while peasant is actively running (could corrupt in-progress work)

## Worklog

- Added `kd peasant sync <ticket-id>` command between `clean` and `msg`
- Merges `resolve_current_run(base)` (parent feature branch) into worktree
- On conflict: prints git output, runs `git merge --abort`, gives manual instructions
- Reuses same init-worktree.sh pattern from `create_worktree()`
- Liveness check uses same `status == "working"` + PID pattern as reject/msg
- 7 new tests: happy path, refuse-while-running, dead-pid-allows, no-worktree, conflict-aborts, init-script, not-found
- No difficulties
