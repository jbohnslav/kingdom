---
id: "9124"
status: open
deps: []
links: []
created: 2026-02-15T17:43:41Z
type: task
priority: 3
---
# Add error/complete metadata to thread message frontmatter

## Context

From 6412 council review: when an agent times out with partial text, `thread_body()` returns just the text (no error marker). This means `council retry` can't distinguish a full response from a partial one cut off by timeout.

Currently acceptable because timeouts are non-retriable and users see the timeout in watch output. But when building richer thread semantics (chat TUI, group chat, thread history injection), proper message metadata will be needed.

## Design (from codex review, council-1bff)

Add optional frontmatter fields to assistant messages:
- `error`: string or null — error message if the response failed/was partial
- `complete`: bool — whether the response finished normally

Example partial-timeout message:
```yaml
---
from: claude
to: king
timestamp: 2026-02-15T10:30:45Z
error: "Timeout after 600s"
complete: false
---

Partial response text here...
```

## Acceptance Criteria

- [ ] Add `error` and `complete` fields to `Message` dataclass (optional, default None/True)
- [ ] Update `add_message()` to accept and serialize optional error/complete fields
- [ ] Update `parse_message()` to read error/complete from frontmatter (backward-compatible with existing messages)
- [ ] Update `AgentResponse.thread_body()` to always return text; pass error metadata separately
- [ ] Update `council retry` to check `msg.error` metadata first, fall back to body prefix for legacy messages
- [ ] Update `council show` / `render_response` to surface error state when metadata present
- [ ] Test: retry after timeout+partial text should re-query
- [ ] Test: retry after clean full response should not re-query
- [ ] Test: legacy thread with `*Error:` body and no metadata still retries
- [ ] Test: mixed thread (some metadata, some legacy) behaves deterministically
