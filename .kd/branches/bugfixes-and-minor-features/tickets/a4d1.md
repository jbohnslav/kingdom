---
id: "a4d1"
status: closed
deps: []
links: []
created: 2026-02-21T17:46:07Z
type: task
priority: 2
---
# has_code_changes returns false negative when start_sha is None

Council review flagged this as blocking.

In `harness.py:171-198`, when `start_sha` is `None` (e.g. agent state didn't record it), `has_code_changes` only checks `git status --porcelain`. If the peasant committed all its changes and the working tree is clean, `git status` returns nothing and the function returns `False` — incorrectly rejecting valid work. This is the guard that rejects premature DONE, so a false negative means the peasant's valid work gets bounced.

When `start_sha` is `None` and `git status` is clean, fall back to something safe — either assume changes exist (`return True`) or check `git log -1` for recent commits.

## Acceptance Criteria

- [ ] `has_code_changes` returns `True` when `start_sha` is `None` but commits exist on the branch
- [ ] Test covers the `start_sha=None` + clean working tree + committed changes scenario
