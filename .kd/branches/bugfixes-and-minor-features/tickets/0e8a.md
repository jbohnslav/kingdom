---
id: "0e8a"
status: in_progress
deps: []
links: []
created: 2026-02-20T14:43:44Z
type: task
priority: 1
---
# Peasant quality gates use wrong Python path and assume Python project

## Problem

The harness and `kd peasant review` both hardcode automatic pytest+ruff execution. This is broken (`sys.executable` points to kd's tool venv, not the project's) and unnecessary â€” the coding agents already know how to run tests/lint as part of their work, and council reviewers can verify independently.

## Plan

Remove all automatic quality gate execution. Instead, rely on agent prompts to instruct peasants and reviewers to run appropriate tests, linting, and pre-commit hooks for the project. This is simpler, language-agnostic, and actually works.

### Changes needed
1. **harness.py**: Delete `worktree_python()`, `run_tests()`, `run_lint()` and the quality gate block in the DONE handler. Update `build_prompt()` to tell the agent to run tests/lint/hooks before reporting DONE.
2. **harness.py**: Update `build_review_prompt()` to tell council reviewers to run tests/lint themselves.
3. **cli.py**: Remove automatic pytest/ruff from `kd peasant review`.
4. **tests**: Remove/update all quality gate mocks and assertions.

## Acceptance Criteria

- [ ] `worktree_python()`, `run_tests()`, `run_lint()` removed from harness
- [ ] Quality gate block removed from `run_agent_loop()` DONE handler
- [ ] Automatic pytest/ruff removed from `kd peasant review`
- [ ] Peasant prompt instructs agent to run appropriate tests/lint/hooks before reporting DONE
- [ ] Council review prompt instructs reviewers to verify tests/lint pass
- [ ] All tests pass
