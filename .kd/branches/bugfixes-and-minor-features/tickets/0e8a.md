---
id: "0e8a"
status: open
deps: []
links: []
created: 2026-02-20T14:43:44Z
type: task
priority: 1
---
# Peasant quality gates use wrong Python path and assume Python project

## Problem

`harness.py:worktree_python()` falls back to `sys.executable` when no `.venv/bin/python` exists in the worktree. When kd is installed as a uv tool, `sys.executable` points to kd's own isolated environment (e.g. `/home/jim/.local/share/uv/tools/kingdom-cli/bin/python`), which has no pytest or ruff. Quality gates then fail with "No module named pytest/ruff" on every peasant run.

Separately, the quality gates are hardcoded to Python tools (pytest + ruff). This breaks for non-Python projects (TypeScript, Go, Rust, etc.) and makes kd Python-only in practice.

### Relevant code
- `worktree_python()` — `src/kingdom/harness.py:184-192`
- `run_tests()` — `src/kingdom/harness.py:195-215`
- `run_lint()` — `src/kingdom/harness.py:218-238`
- Quality gate integration — `src/kingdom/harness.py:650-674`

## Acceptance Criteria

- [ ] Peasant quality gates resolve the correct Python (project venv, not kd's tool venv) when running in worktree mode
- [ ] Peasant quality gates resolve the correct Python in `--hand` mode (cwd, not kd's tool venv)
- [ ] Quality gates are configurable per-project (not hardcoded to pytest/ruff) — e.g. via `.kd/config.toml` or project detection
- [ ] Non-Python projects can specify their own test/lint commands (or have gates skipped gracefully)
- [ ] Existing Python projects with `.venv` continue to work as before
