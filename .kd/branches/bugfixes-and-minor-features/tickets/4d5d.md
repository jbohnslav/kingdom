---
id: "4d5d"
status: closed
deps: []
links: []
created: 2026-02-21T18:13:19Z
type: task
priority: 2
---
# get_diff fallback misses staged changes when start_sha is None

Found by Claude's PR review on #26.

`harness.py` in `get_diff`: the `else` branch (no `start_sha`) runs `git diff HEAD` which only shows unstaged changes. The comment says "staged + unstaged" but staged hunks are missed. To include both, run `git diff HEAD` (unstaged) + `git diff --cached` (staged) and concatenate. Only hit when `start_sha` is None, so it's a rare fallback, but a council reviewer asking for "what changed" would get incomplete output.

## Acceptance Criteria

- [ ] `get_diff` with `start_sha=None` includes both staged and unstaged changes
- [ ] Test covers the staged-only changes scenario

## Worklog

- [18:21] â€” Closed: Not a bug: git diff HEAD compares HEAD to working tree, which includes both staged and unstaged changes. Verified with manual test.
