---
id: "3f8c"
status: closed
deps: []
links: []
created: 2026-02-17T03:04:15Z
type: task
priority: 2
---
# kd chat: reply/quote button on messages

Add a reply action that quotes the original message and @mentions the sender. Prefill input area with quoted context block.

## Work Log

- Added `format_reply_text()` helper in `widgets.py` that builds `@sender\n> quoted lines\n\n`
  - Truncates long messages to 4 lines with `...` ellipsis
- Added `MessagePanel.Reply` Textual Message class that bubbles up on click
- Changed `MessagePanel.on_click()` to dispatch: click = reply, shift+click = copy
- Updated border subtitle to `"click: reply Â· shift+click: copy"`
- Added `on_message_panel_reply()` handler in `ChatApp` to prefill input area
  - Preserves existing draft text, focuses input, moves cursor to end
- Updated `/help` text to document reply and shift+click behaviors
- Added comprehensive tests in `test_tui_reply.py` (18 tests) and updated `test_tui_clipboard.py`
