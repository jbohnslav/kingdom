---
id: 101d
status: closed
deps: []
links: []
created: 2026-02-14T02:03:43Z
type: task
priority: 1
---
# Council members should not modify files — enforce read-only mode

Council members (claude, codex, cursor) are meant to advise — read code, analyze, and respond with recommendations. They should never write files, delete tickets, or make code changes. Cursor just deleted backlog tickets and wrote code during a council query. Strengthen the council prompts/instructions to make it absolutely clear that council members must not modify anything. They should only read, plan, and respond. If the agent platform supports a read-only or no-write mode, use that too.

## Acceptance Criteria

- [x] Council member prompts explicitly forbid file writes, edits, and deletions
- [x] Review each agent's allowed_tools / permission config for read-only enforcement
- [ ] Test that a council query doesn't produce any file modifications

## Implementation Notes (council)

**Key files:** `src/kingdom/council/base.py` (COUNCIL_PREAMBLE ~L39-45), `src/kingdom/agent.py` (command builders ~L257-317)

**Approach — two layers of defense:**
1. **Prompt layer:** Strengthen `COUNCIL_PREAMBLE` to explicitly forbid writes, edits, deletions, and any file modifications. Be specific: "Do NOT create, edit, delete, or write any files. Do NOT run git commands that modify state. You are read-only."
2. **Tool/permission layer:** For Claude Code, use `--allowedTools` to restrict to read-only tools (Read, Glob, Grep, WebFetch, WebSearch — no Bash, Edit, Write). For Codex, use `--sandbox read-only` if available. Check Cursor sandbox options.

**Gotchas:**
- `build_claude_command()` currently uses `--dangerously-skip-permissions` which gives full access — the opposite of what we want for council
- `skip_permissions` in `build_command()` is currently always True for council — need to differentiate council (read-only) from peasant (full access) invocations
- Codex and Cursor may have different sandboxing mechanisms — check their CLI docs
- Agents still need read access (Read, Glob, Grep, etc.) to be useful

## Worklog

- Strengthened COUNCIL_PREAMBLE: explicit "You are READ-ONLY" with specific prohibitions (no file writes, no git modify, no kd modify)
- Claude: added `--allowedTools Read Glob Grep WebFetch WebSearch` when skip_permissions=False
- Codex: added `-c 'sandbox_permissions=["disk-full-read-access"]'` for read-only sandbox
- Cursor: added `--mode ask` for read-only Q&A mode (discovered via `agent --help`)
- Updated tests in test_agent.py and test_council.py to verify read-only flags
- Note: skip_permissions was already False for council (set in CouncilMember.build_command) — the code path was correct, just missing the enforcement flags
- Third acceptance criterion (manual test) deferred — needs a live council query to verify
