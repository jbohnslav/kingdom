---
id: 8af5
status: closed
deps: []
links: []
created: 2026-02-14T01:37:56Z
type: task
priority: 1
---
# kd done should error if branch has open tickets

When running `kd done`, if the branch still has open tickets, the command should error out and list the open tickets instead of silently marking the session as done. This prevents losing track of unfinished work. Add a `--force` flag to override when the user intentionally wants to close out with open tickets (e.g. moving them to backlog manually).

## Acceptance Criteria

- [x] `kd done` checks for open tickets on the branch before marking done
- [x] If open tickets exist, print them and exit with an error
- [x] `--force` flag bypasses the check
- [x] Error message suggests next steps (close tickets, move to backlog, or use --force)

## Implementation Notes (council)

**Key files:** `src/kingdom/cli.py` (done command ~L203-269), `src/kingdom/ticket.py` (for `list_tickets`)

**Approach:**
- After resolving the branch directory in `done()`, call `list_tickets()` on the branch's tickets dir
- Filter for status != "closed" — both `open` and `in_progress` count as not done
- If any remain and `--force` is not set, print each open ticket (ID + title + status) and exit via `raise typer.Exit(1)`
- Add `force: bool = typer.Option(False, "--force")` parameter
- Error message should suggest: "Close tickets, move them to backlog with `kd tk move`, or use `--force`."

**Gotchas:**
- Current `done()` signature takes only `feature` — adding `--force` is clean with typer
- Handle the legacy `.kd/runs/` path too, or decide to skip it
- Only check tickets belonging to the current branch, not the backlog

## Worklog

- Added `--force` / `-f` flag to `done()` command
- Added open ticket check after branch existence validation, before state update
- Filters `list_tickets()` for status != "closed" (catches both open and in_progress)
- Prints each open ticket with ID, status, and title
- Error message suggests closing, moving to backlog, or --force
- Legacy `.kd/runs/` path: skipped ticket check (legacy branches won't have ticket structure)
- All 486 tests pass
