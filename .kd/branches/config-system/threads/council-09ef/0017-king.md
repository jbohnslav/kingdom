---
from: king
to: all
timestamp: 2026-02-14T15:57:38Z
---

We have 5 test failures caused by 2 bugs introduced in the config-system branch. Here are my findings:

**Bug 1 — timeout=None passed to member.query() (causes 4 test failures)**

Tests: test_ask_to_specific_member, test_single_mention_targets_member, test_to_flag_overrides_mentions, test_watch_targeted_ask_completes_without_timeout (downstream)

The CLI --timeout defaults to None (cli.py:320). When --to targets a single member, member.query(prompt, timeout) is called at lines 403 and 483, passing None directly. This overrides the method's default of 600. Then at base.py:120:

    if time.monotonic() - start > timeout:  # float > None → TypeError

Line 467 has the same latent bug: timeout + 30 would also TypeError with None when using --async without --timeout.

The simplest fix options:
A) At call sites: member.query(prompt, timeout or c.timeout)
B) In the query method: guard with if timeout is not None
C) Resolve None to c.timeout earlier in council_ask, so all downstream code gets a real int

**Bug 2 — Status role logic inverted (1 test failure)**

Test: test_status_json_still_includes_design_breakdown

At cli.py:1898 and 2080:

    role = 'hand' if os.environ.get('CLAUDECODE') else 'king'

This is backwards. CLAUDECODE=1 means we are running inside Claude Code (the king's environment), so it should yield 'king'. The test runs inside Claude Code, gets 'hand' when it expects 'king'.

Fix is straightforward: swap the ternary.

What are your thoughts on the best fix approach, especially for Bug 1? Option C (resolve early) seems cleanest to me since it fixes all call sites at once.
