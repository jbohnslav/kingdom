---
id: e01c
status: closed
deps: []
links: []
created: 2026-02-14T16:12:20Z
type: bug
priority: 1
---
# Fix timeout=None TypeError in council targeted queries

## Problem

The CLI `--timeout` option defaults to `None` (cli.py:320). When `--to` targets
a single member, `None` is passed directly to `member.query()` and
`watch_thread()`, causing a TypeError on comparison:

```
TypeError: '>' not supported between instances of 'float' and 'NoneType'
```

This breaks 3 tests directly and 1 downstream:

- `TestCouncilAsk::test_ask_to_specific_member` (line 140) — TypeError
- `TestCouncilMentions::test_single_mention_targets_member` (line 567) — TypeError
- `TestCouncilMentions::test_to_flag_overrides_mentions` (line 632) — TypeError
- `TestCouncilWatch::test_watch_targeted_ask_completes_without_timeout` (line 506) — downstream: the `--to` ask fails before writing a response, so watch times out

## Root Cause

Three call sites in `council_ask` pass the raw CLI `timeout` (which may be
`None`) instead of falling back to `c.timeout`:

- **cli.py:403** — `member.query(prompt, timeout)` (JSON single-member path)
- **cli.py:483** — `member.query(prompt, timeout)` (default single-member path)
- **cli.py:467** — `watch_thread(..., timeout=timeout + 30, ...)` (async path, latent bug: `None + 30`)

The comparison that crashes is in `council/base.py:120`:
```python
if time.monotonic() - start > timeout:  # float > None → TypeError
```

## Fix

Resolve `timeout` to `c.timeout` early in `council_ask`, right after the council
is created (after line 343). Use explicit `None` check, not `or`, to preserve
`--timeout 0`:

```python
timeout = timeout if timeout is not None else c.timeout
```

This fixes all three call sites at once.

## Acceptance Criteria

- [x] All 4 failing tests pass
- [x] `timeout` resolved to `c.timeout` once, early in `council_ask`
- [x] No other call sites pass raw `None` timeout downstream

## Worklog

Added `timeout = c.timeout` at cli.py:344, right after the CLI override is
applied to `c.timeout`. This is the simplest form of Option C — since the CLI
already writes its override into `c.timeout` (line 342-343), we just read it
back. One line, fixes all three downstream call sites.

Council recommended `timeout if timeout is not None else c.timeout`, but since
we already set `c.timeout = timeout` when not None, `timeout = c.timeout` is
equivalent and simpler.

Full suite: 550 passed, 3 skipped, 0 failed.
