---
id: 3f8e
status: closed
deps: [d52d, a9f1]
links: []
created: 2026-02-14T14:12:21Z
type: task
priority: 2
---
# Update kd doctor to validate config

Extend `kd doctor` to validate `.kd/config.json` and check backend CLIs.

## Details

- Parse `.kd/config.json` and report errors (invalid JSON, unknown keys, missing required fields, bad cross-references)
- For each agent defined in config, check that its backend CLI is installed using `BACKEND_DEFAULTS[backend]["version_command"]`
- Report missing CLIs with the `install_hint` from `BACKEND_DEFAULTS`
- If no config file exists, report that defaults are in use (not an error)

## Acceptance Criteria

- [x] `kd doctor` validates config JSON syntax
- [x] `kd doctor` reports unknown keys, missing fields, bad cross-references
- [x] `kd doctor` checks each configured agent's backend CLI is installed
- [x] Missing CLIs show install hints
- [x] No config file is reported as "using defaults" (not an error)
- [x] Existing doctor checks (non-config) still work

## Worklog

- Added check_config() function that validates config via load_config()
- Doctor now shows Config section before Agent CLIs section
- "No config.json (using defaults)" shown with yellow ○ when file is absent
- Config errors shown with red ✗ and detailed error message
- JSON output restructured: {"config": {...}, "agents": {...}}
- Updated existing tests, added 4 new tests (invalid config, no config, valid config, JSON invalid)
- Manually verified `kd doctor` and `kd doctor --json` output
