---
id: "51d9"
status: closed
deps: [bec3, 92ce]
links: []
created: 2026-02-17T17:31:39Z
type: task
priority: 2
---
# kd peasant review accept/reject UX

## Description

Update `kd peasant review` to work with the new `in_review` ticket status and session sub-states.

Commands:
- `kd peasant review <ticket>` — show review info: diff, worklog, council feedback. Valid only when ticket is `in_review`.
- `kd peasant review <ticket> --accept` — integrate peasant branch/worktree changes into parent branch, then close ticket and set session → `done`.
- `kd peasant review <ticket> --reject "feedback"` — ticket → `in_progress`, session → `working`, write feedback to thread, auto-resume peasant.
- `kd peasant review <ticket> --reject --no-resume "feedback"` — same but don't relaunch the peasant.

On `--reject`, force ticket to `in_progress` (matching the transition rule from design).
On `--accept`, close only after integration succeeds. If integration fails, keep ticket `in_review` and session `needs_king_review`, and print explicit recovery steps.

## Acceptance Criteria

- [ ] `kd peasant review <ticket>` shows diff, worklog, and council feedback
- [ ] `--accept` integrates peasant changes into parent branch and closes only on success
- [ ] On `--accept` integration failure, ticket remains `in_review`, session remains `needs_king_review`, and recovery commands are shown
- [ ] `--reject` writes feedback to thread, sets ticket `in_progress` / session `working`
- [ ] `--reject` auto-resumes peasant by default
- [ ] `--no-resume` flag prevents auto-resume on reject
- [ ] Command rejects if ticket is not `in_review`
- [ ] Tests pass
