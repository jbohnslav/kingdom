---
id: "92ce"
status: open
deps: ["bec3"]
links: []
created: 2026-02-17T17:31:32Z
type: task
priority: 2
---
# Session state additions (awaiting_council, needs_king_review, start_sha, review_bounce_count)

## Description

Add new session statuses and state fields to support the review phase.

New session statuses: `awaiting_council`, `needs_king_review` — added to `AGENT_STATUSES` in `session.py`.

New fields on `AgentState`:
- `start_sha: str | None` — commit SHA when peasant starts work. Recorded once on first iteration. Used for diff scoping in council review.
- `review_bounce_count: int` — number of council rejection cycles (default 0). Persisted to session JSON so restarts don't reset it.

Update session display/status commands to handle new statuses with appropriate styling.

## Acceptance Criteria

- [ ] `awaiting_council` and `needs_king_review` added to `AGENT_STATUSES`
- [ ] `start_sha` field added to `AgentState`, persisted in session JSON
- [ ] `review_bounce_count` field added to `AgentState`, default 0, persisted
- [ ] Harness records `start_sha` on first iteration if not already set
- [ ] `kd peasant status` displays new statuses correctly
- [ ] Tests pass
