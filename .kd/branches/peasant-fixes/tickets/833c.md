---
id: "833c"
status: in_progress
deps: []
links: []
created: 2026-02-19T17:19:03Z
type: bug
priority: 1
---
# Claude Code Review workflow not triggering on pull_request

## Problem

The `.github/workflows/claude-code-review.yml` auto-review workflow stopped firing on `pull_request` events. PR #25 did not get an automatic Claude review — had to manually tag `@claude`.

## Investigation Findings

- **Last successful auto-review:** Feb 17, 2026 on the `polish` branch (workflow run `22086091776`)
- **`anthropics/claude-code-action@v1` was updated:** `v1.0.53` (Feb 16) → `v1.0.54` (Feb 18)
- **Symptom:** GitHub shows workflow name as raw path (`.github/workflows/claude-code-review.yml`) instead of `Claude Code Review`, indicating YAML parsing failure
- **Failed runs show:** "This run likely failed because of a workflow file issue" — but only on `push` events (expected, since the workflow only defines `on: pull_request`)
- **The `pull_request` event simply never triggers the workflow at all** — 0 runs for `peasant-fixes` branch, while CI workflow fires fine
- **Close/reopen PR did not help** — `reopened` event also failed to trigger it
- **Repo settings are fine:** Actions enabled, workflow state is `active`, `CLAUDE_CODE_OAUTH_TOKEN` secret exists
- **Workflow YAML is identical on master and branch** — no local modifications

## Root Cause (confirmed via council-f3f9)

GitHub now rejects `secrets.*` inside `if:` expressions in workflow files. Both Claude workflows (`claude-code-review.yml` and `claude.yml`) fail with pre-job validation errors:
- Runs show `jobs: []` and no logs — these are **registration-level failures**, not runtime failures
- GitHub classifies them as "workflow file issue"
- Both workflows create failing `push` runs even though they don't declare `push` triggers, confirming validation/registration breakage

The `v1.0.53 → v1.0.54` version bump was a timing coincidence, not the cause.

## Fix

Remove `secrets.*` from `if:` expressions in both workflow files. Use environment variables or other supported patterns instead.

## Acceptance Criteria

- [x] `secrets.*` references removed from `if:` expressions in `claude-code-review.yml` and `claude.yml`
- [ ] Auto-review workflow triggers on PR creation without manual intervention
- [ ] Both workflows show successful runs (not "workflow file issue")

## Worklog

- 2026-02-19: Updated ticket hypothesis — treat `claude-code-action@v1.0.54` as likely correlation, not confirmed cause.
- 2026-02-19: Root cause confirmed via council thread `council-f3f9`. Codex used `gh` API to find that GitHub rejects `secrets.*` in `if:` expressions. Both Claude workflows affected.
- 2026-02-19: Confirmed exact errors via GitHub run pages: "Unrecognized named-value: 'secrets'" at line 35 (claude-code-review.yml) and line 54 (claude.yml). Removed `if: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN != '' }}` from both workflow step definitions.
