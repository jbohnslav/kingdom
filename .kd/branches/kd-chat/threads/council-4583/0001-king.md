---
from: king
to: all
timestamp: 2026-02-16T19:01:50Z
---

We have a cross-talk problem (ticket 0f27): when kd chat is open while other agent workflows run (kd council ask, peasant workers), session state bleeds across contexts. Chat threads showed one Cursor session lineage while branch state pointed to a different one because concurrent non-chat flows were updating per-agent state.

Current architecture: session IDs are stored per-agent in .kd/sessions/{agent}.json at branch level. Both chat and non-chat workflows read/write the same files.

Questions for the council:
1. What's the right isolation boundary? Per-workflow-type session files (chat vs council vs peasant)? Per-thread session files? Something else?
2. Should chat sessions be completely independent (fresh each time) or should they persist within a thread but be isolated from non-chat workflows?
3. How do we handle the case where a user starts a chat, then runs kd council ask in another terminal â€” should those share any context or be fully isolated?
4. What are the edge cases and failure modes we need to worry about?
