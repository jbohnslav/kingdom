---
id: "d869"
status: closed
deps: [f9d2, 16e1]
links: []
created: 2026-02-15T19:46:08Z
type: task
priority: 2
---
# Escape interrupt: kill TUI-launched subprocesses

## Context

Escape key kills all currently-generating subprocesses launched by this TUI process and cancels pending auto-turns. Uses `member.process.terminate()` from the Popen handle stored on CouncilMember.

## Acceptance Criteria

- [x] Escape key binding in ChatApp triggers interrupt handler
- [x] Interrupt handler calls `member.process.terminate()` on all members with active subprocesses
- [x] Only kills queries launched by this TUI process (checks `member.process` is not None)
- [x] Prevents next auto-turn from scheduling (sets interrupt flag)
- [x] StreamingPanel for interrupted members shows interrupted state (not stuck as "streaming")
- [x] Second Escape during `/quit` forces immediate exit
- [x] Does not crash if no queries are running when Escape is pressed

## Worklog

- Replaced Escape binding from `action_quit` to `action_interrupt`.
- First Escape with active queries: terminates processes, replaces waiting/streaming panels with ErrorPanel("*Interrupted*") immediately, sets `self.interrupted = True`.
- First Escape with nothing running: exits app.
- Second Escape (interrupted=True): force exits regardless of worker state.
- `run_query()` now passes `max_retries=0` to avoid retrying after terminate.
- Interrupted queries with no useful text persist `*Interrupted*` instead of "Exit code -15".
- `send_message()` resets `interrupted` flag so Escape works normally for next round.
- `handle_new_message()` checks for `interrupted-{name}` panels to replace cleanly when finalized message arrives.
- 7 new tests: flag init, no-council exit, no-active exit, terminate active, second escape, interrupted body, partial text preservation. Full suite 754 pass.
