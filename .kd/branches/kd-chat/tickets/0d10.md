---
id: "0d10"
status: closed
deps: []
links: []
created: 2026-02-16T13:17:00Z
type: task
priority: 2
---
# kd chat: message panels don't render markdown (Static widget shows raw text, need Markdown widget or markup)

## Problem

`MessagePanel` extends `Static` and calls `self.update(body)` with raw text. Markdown syntax (`**bold**`, `# headers`, `` `code` ``, `- lists`) shows up as literal characters instead of being rendered.

## Design

Use `rich.markdown.Markdown` as the renderable passed to `Static.update()`. Smallest fix â€” keep `Static` base class, wrap body in Rich Markdown. No structural widget changes.

Also apply to `ErrorPanel`. `StreamingPanel` stays raw text (re-parsing markdown on every delta is too expensive).

## Acceptance Criteria

- [x] `MessagePanel` renders markdown formatting (bold, code, lists, headers).
- [x] `ErrorPanel` renders markdown formatting.
- [x] `StreamingPanel` remains raw text (no markdown parsing during streaming).
- [x] Existing tests pass.
- [x] Integration test verifies markdown rendering.

## Worklog

- 2026-02-16: Fixed by wrapping body in `rich.markdown.Markdown` in `Static.update()`:
  - `MessagePanel.on_mount()`: `self.update(RichMarkdown(self.compose_text()))`
  - `ErrorPanel.on_mount()`: `self.update(RichMarkdown(self.error))`
  - `StreamingPanel` unchanged (raw text for performance during streaming)
  - Added failing integration test first (`test_markdown_is_rendered`), then fixed
  - 884 passed, 3 skipped, 1 xfailed
