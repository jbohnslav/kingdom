---
id: "213e"
status: open
deps: [7656]
links: []
created: 2026-02-15T19:46:12Z
type: task
priority: 2
---
# Thread history injection: format_thread_history()

## Context

Build `format_thread_history()` function that constructs a multi-party conversation prompt from thread messages. Used by auto-turn scheduler to give each agent full cross-agent awareness. No session resume (`--resume`) — thread history is the only context source.

## Acceptance Criteria

- [ ] `format_thread_history(thread_dir, target_member)` reads all finalized messages in sequence order
- [ ] Output format: `[Previous conversation]\nking: ...\n\nclaude: ...\n\n---\nYou are {target_member}. Continue the discussion.`
- [ ] History block contains message bodies only — no preambles, frontmatter, or instructions
- [ ] Each member identified by `from` field from message frontmatter
- [ ] Preamble (safety + phase + agent prompts) prepended before history block by caller
- [ ] Full thread history included (no truncation) — human manages context boundaries
- [ ] Unit tests: empty thread, single message, multi-member conversation, directed @member messages
